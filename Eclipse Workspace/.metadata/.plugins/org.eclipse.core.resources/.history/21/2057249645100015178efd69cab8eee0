
public class PID {
	
	static double kp, ki, kd;
	static State state, state_old;
	static double goal;
	static double intVal;
	
	public PID (double goal, double Kp, double Ki, double Kd){
		this.kp = Kp;
		this.ki = Ki;
		this.kd = Kd;
		this.goal = goal;
		intVal = 0.0d;
	}
	
	public double process(double input, State currState){
		state_old = state;
		state = currState;
		double out = 0.0d;
		//Proportional reaction to the difference in state
		out += kp*state.getVal()-goal;
		
		//Derivative reaction to the difference in state
		out -= kd* ( (state.getVal() - state_old.getVal()) / (state.getTime() - state_old.getTime()) );
		
		//Integral reaction to the difference in state
		intVal += (state_old.getVal() * (state.getTime() - state_old.getTime())) + //area of the rectangel formed
				( state.getVal() - state_old.getVal() *  (state.getTime() - state_old.getTime() / 2)); 
				//Area of the triangle formed by the change, and negative if the value goes down, so will subtract from the area
		out+= ki * intVal; //intVal constantly increases by summing all the integral errors over time.
		
		return out;
	}
	
}
